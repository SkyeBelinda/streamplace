<!doctype html>
<html>
<head>
  <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  <link href="//vjs.zencdn.net/4.12/video-js.css" rel="stylesheet">
  <script src="//vjs.zencdn.net/4.12/video.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <style>
    html, body {
      height: 100%;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
    }
    .button-panel {
      display: flex;
      width: 100%;
      justify-content: space-around;
    }
    .big {
      width: 150px;
      height: 60px;
    }
    .button-success {
      background: rgb(28, 184, 65); /* this is a green */
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      console.log("DOM fully loaded and parsed");
      var socket = io.connect('http://drumstick.iame.li:3000');
      var streams = [];
      var currentStream = 0;
      var rerender = function() {
        $('.button-panel').empty();
        streams.forEach(function(stream, idx) {
          $('.button-panel').append(
            '<button class="pure-button pure-button-primary big" idx="' + idx + '">' +
            stream.name +
            '</button>');
        });
        $('button[idx=' + currentStream +']').addClass('button-success');
      };
      socket.on('streams', function(newStreams) {
        streams = newStreams;
        rerender();
      });
      socket.on('activeStream', function(newCurrentStream) {
        currentStream = newCurrentStream;
        rerender();
      });
      $('body').on('click', '.big', function(e) {
        socket.emit('switch', parseInt($(e.currentTarget).attr('idx')));
      });
    });
  </script>
</head>
<body>
  <div>
    <video id="really-cool-video" class="video-js vjs-default-skin" controls
        preload="auto" width="1280" height="720"
        data-setup='{}'>
        <source src="http://drumstick.iame.li:8080/stream/test.m3u8" type='application/x-mpegURL'>
        <source src="rtmp://drumstick.iame.li:1934/tv/test" type="rtmp/mp4">
    </video>
  </div>
  <div class="button-panel">
    <!-- <button class="pure-button pure-button-primary big">Do it!</button> -->
  </div>
</body>
</html>